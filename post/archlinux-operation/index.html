<!DOCTYPE html>
<html class="nojs" lang="zh-cn" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>archlinux使用操作拾遗 – psycode - better code, better life.</title>
<meta name="description" content="这周末打开了未经常使用的archlinux，使用过程中遇到了一些问题，进行了解决，在此做个记录。 archlinux无线联网问题 我安装的archinux是命令行版本，只能无线联网。 检测网卡的PCI-ID lspci -vnn | grep 14e4: 获取驱动    驱动 描述     brcmsmac/brcmfmac …">
<meta name="created" content="2019-02-13T11:22:54+0800">
<meta name="modified" content="2019-02-13T11:22:54+0800">
<meta name="author" content="sypeng">
<meta name="contact" content="psyucc@163.com">
<meta property="og:site_name" content="psycode - better code, better life.">
<meta property="og:title" content="archlinux使用操作拾遗">
<meta property="og:url" content="https://sh1yu.github.io/post/archlinux-operation/">
<meta property="og:type" content="article">

<meta name="generator" content="Hugo 0.87.0" />
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<link rel="canonical" href="https://sh1yu.github.io/post/archlinux-operation/">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<link rel="stylesheet" href="/css/mobile.2ab74aa64785dcab8114959e76ca140cf76207cd85989bc6d4fc3b12f734a09e.css" media="screen">
<link rel="stylesheet" href="/css/styles.220f12cbeefa3ca61dd63c4390295bf3974c4ba9557837d5e408db1b40a477ee.css">
<link rel="stylesheet" href="/css/print.27fc184f8670f41a2690985390779e7b20335a8fadff8fa015cf9417ffe50c36.css" media="print">

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "archlinux使用操作拾遗",
    "datePublished": "2019-02-13T11:22:54+08:00",
    "dateModified": "2019-02-13T11:22:54+08:00",
    "url" : "https://sh1yu.github.io/post/archlinux-operation/",
    "description": "这周末打开了未经常使用的archlinux，使用过程中遇到了一些问题，进行了解决，在此做个记录。 archlinux无线联网问题 我安装的archinux是命令行版本，只能无线联网。 检测网卡的PCI-ID lspci -vnn | grep 14e4: 获取驱动    驱动 描述     brcmsmac/brcmfmac …",
    "keywords": ["archlinux","linux"],
    "author": {
      "@type": "Person",
      "name": "sypeng"
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://sh1yu.github.io"
    },
    "publisher": {
      "@type": "Organization",
      "name": "psycode - better code, better life.",
      "url": "https://sh1yu.github.io"
    }
  }
</script>

<script src="/js/script-early.min.3b0e641814c87f6a1d6ffa5e7d597f29faa8ce11482541e8801dc34013817c91.js"></script>
<script defer src="/js/lib/jquery.slim.min.bbb7b9921ca2b61948753a6edb63c78443663dc45d1621d18e102e1dcb34e512.js"></script>
<script defer src="/js/lib/umbrella.min.6e17830ccdded0a13b96d6993865b58202bc2ee750e5892a51858ab048b2bebb.js"></script>
<script defer src="/js/mobile.min.abb9438113cb72181ecda30b9375cc0771c7ce2e7354414a7c1296b45cf47135.js"></script>
<script src="/js/lib/js.cookie.min.31d1799663bbb6029214d90ba7db9cdc725fa02c16d4b090add3721e44238b6b.js"></script>
<script defer src="/js/cookieconsent.min.21a8d7c181aecb9bb5b91b2e1735d9fd9d283a8a752e9dcdf33c052137987f2b.js"></script>
<script defer src="/js/script.min.c2752732454d16255cfd30375b9a3e48a37b7b809c917b33920889c859ba1300.js"></script>


</head>

<body class="single-page">
<div class="page layout__page layout__sidebar-second">
<header class="header layout__header">

<h1 class="header__site-name">
<a href="/" title="Home" class="header__site-link" rel="home"><span>psycode - better code, better life.</span></a>
</h1>
<div class="region header__region">
</div>
</header>

<nav class="main-menu layout__navigation">
<h2 class="visually-hidden">Main menu</h2>
<ul class="navbar">
<li><a href="/">Home</a></li>
<li><a href="/post/" class="active" aria-current="page">Posts</a></li>
</ul>
</nav>


<main class="main layout__main">
<article class="section-post single-view">
<header>
<h1 class="title title-submitted">archlinux使用操作拾遗</h1>
<div class="submitted">
<span class="author" itemprop="author">sypeng</span> - <time class="created-date" datetime="2019-02-13T11:22:54&#43;08:00">13 February, 2019</time>
</div>
<div class="tags">
Tags:
<ul>
<li><a href="/tags/archlinux">archlinux</a></li>
<li><a href="/tags/linux">linux</a></li>
</ul>
</div>
</header>
<div class="content">
<p>这周末打开了未经常使用的archlinux，使用过程中遇到了一些问题，进行了解决，在此做个记录。</p>
<h1 id="archlinux无线联网问题">archlinux无线联网问题</h1>
<p>我安装的archinux是命令行版本，只能无线联网。</p>
<p>检测网卡的PCI-ID</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lspci -vnn | grep 14e4:
</code></pre></div><p>获取驱动</p>
<table>
<thead>
<tr>
<th>驱动</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>brcmsmac/brcmfmac</td>
<td>开源内核驱动</td>
</tr>
<tr>
<td>b43</td>
<td>逆向工程内核驱动</td>
</tr>
<tr>
<td>broadcom-wl</td>
<td>专有的 Broadcom STA 驱动</td>
</tr>
</tbody>
</table>
<p>b43/b43legacy的运行都需要安装闭源固件， 请从AUR安装b43-firmware， b43-firmware-classic或者 b43-firmware-legacy。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lsmod |grep b43
</code></pre></div><p>发现b43驱动已经安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl status NetworkManager
</code></pre></div><p>发现<code>NetworkManager</code>已经安装（<code>pacman</code>安装包为<code>networkmanager</code>）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmcli dev
</code></pre></div><p>发现无线网尚未连接。使用如下命令成功连接wifi：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmcli dev wifi connect &lt;SSID&gt; password &lt;password&gt;
</code></pre></div><h1 id="archlinux-软件全部升级签名问题">archlinux 软件全部升级签名问题</h1>
<p>使用<code>sudo pacman -Syu</code>遇到了 <code>invalid or corrupted package ... unknown trust</code>的问题，应该是签名验证不通过，使用如下方法解决了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo pacman-key --init
sudo vim /etc/pacman.conf <span style="color:#75715e">#设置SigLevel = Optional TrustAll</span>
sudo vim /etc/pacman.d/gnupg/gpg.conf <span style="color:#75715e">#设置keyserver hkp://pgp.mit.edu</span>
sudo pacman -Syu 
</code></pre></div><h1 id="archlinux-防火墙配置问题">archlinux 防火墙配置问题</h1>
<p>archlinux的iptable使用systemctl启动时需要先创建<code>iptables.rules</code>文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo touch /etc/iptables/iptables.rules
sudo systemctl start iptables
</code></pre></div><p>使用<code>systemctl</code>启动<code>iptables</code>或者<code>sudo iptables -L</code>时遇到问题：</p>
<pre><code>can't initialize iptables table `filter': Table does not exist (do you need to insmod?)
Perhaps iptables or your kernel needs to be upgraded.
</code></pre><p>使用如下命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">modprobe ip_tables
</code></pre></div><p>得到如下错误：</p>
<pre><code>FATAL: Module ip_tables not found
</code></pre><p>最后发现<code>/boot/</code>下<code>config-*</code>文件表示的内核版本与<code>uname -r</code>的版本不一致，原来是 <code>sudo pacman -Syu</code>升级了内核，系统没有重启。重启系统后问题解决。</p>
<h1 id="mariadb初始化与远程访问配置问题">mariaDB初始化与远程访问配置问题</h1>
<p>archlinux下安装了mariaDB，需要执行初始化才能正常启动服务：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo pacman -S mariadb
sudo mysql_install_db --user<span style="color:#f92672">=</span>mysql --basedir<span style="color:#f92672">=</span>/usr --datadir<span style="color:#f92672">=</span>/var/lib/mysql
sudo systemctl start mariadb
mysqladmin -u root password <span style="color:#e6db74">&#39;12345678&#39;</span> 
</code></pre></div><p>允许远程访问，需要首先确保防火墙配置正常，<code>my.cnf</code>的<code>bind-address</code>配置不为<code>localhost</code>，没有配置<code>skip-networking </code>； 之后配置权限：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;root&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span>IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;123456&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>;
flush <span style="color:#66d9ef">privileges</span>;
</code></pre></div><h1 id="go语言访问mariadb日期格式datetime映射">go语言访问mariaDB日期格式DATETIME映射</h1>
<p>go语言连接mariaDB时如果没有配置<code>parseTime=true</code>，scan到的日期数据为[]int8格式，使用string类型接收时为日期的&quot;2006-01-02 15:04:05&quot;格式化字符串（可以使用sql.NullString接收处理空值）。如果配置了<code>parseTime=true</code>，<code>scan</code>时可以直接使用<code>time.Time</code> ，但是时间为空时会抛出异常。如果使用<code>string</code>类型接收，则字符串格式为<code>time.RFC3339</code>(<code>2006-01-02T15:04:05Z07:00</code>)</p>


<aside class="related layout__related">
</aside>
</div>
</article>
</main>


<aside class="sidebar layout__second-sidebar">
<section>
<h4 class="menu"><a href="/post/" class="active" aria-current="page">Posts</a></h4>
<ul class="menu">
<li><a href="/post/golang%E7%BB%84%E5%90%88%E6%8E%A5%E5%8F%A3%E4%BB%A5%E5%8F%8A%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">golang组合、接口以及反序列化</a></li>
<li><a href="/post/%E4%B8%80%E6%AC%A1springboot&#43;dubbo%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">一次springboot&#43;dubbo的项目实战</a></li>
<li><a href="/post/vscode%E9%85%8D%E7%BD%AEcpp%E5%A4%96%E9%83%A8%E5%A4%B4%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96/">Vscode配置cpp外部头文件依赖</a></li>
<li><a href="/post/install-mysql-in-k8s/">在k8s集群中部署mysql</a></li>
<li><a href="/post/sign-model/">SIGN模型找到天赋</a></li>
<li><a href="/post/knowledge-to-ability/">将知识内化成能力</a></li>
<li><a href="/post/iceberg-model/">冰山模型</a></li>
<li><a href="/post/kubernetes-statefulset/">kubernetes之StatefulSet</a></li>
<li><a href="/post/vert.x-and-future/">Vert.x线程与Future</a></li>
<li><a href="/post/archlinux-operation/" class="active" aria-current="page">archlinux使用操作拾遗</a></li>
<li><a href="/post/run-gogs-with-docker/">使用docker运行gogs服务</a></li>
</ul>
</section>
</aside>
<footer class="footer layout__footer">
<p>This site is licensed under a (<a href="https://creativecommons.org/licenses/by-sa/4.0/)">https://creativecommons.org/licenses/by-sa/4.0/)</a>. [Creative Commons Attribution-ShareAlike 4.0 International License]</p>
<p>A <a href="https://example.org/">example.org</a> production.</p>
<p>Powered by <a href="https://gohugo.io/">Hugo</a> and the <a href="https://github.com/frjo/hugo-theme-zen">Zen theme</a>.</p>
</footer>
<div class="cookieconsent layout__cookieconsent hidden">
  <div class="cookieconsent__message">
    This website uses non essential cookies for tracking and analytics that you can accept or decline.
    
  </div>
  <div class="cookieconsent__actions">
    <button class="button button--small button--cookieconsent button--decline" type="button" data-consent="false">Decline tracking</button>
    <button class="button button--small button--cookieconsent button--accept" type="button" data-consent="true">Accept tracking</button>
  </div>
</div>
</div>
<div class="mobile-nav" dir="ltr">
  <div class="mobile-nav__cover"></div>
  <a href="#navigation" class="mobile-nav__toggle" aria-haspopup="true" role="button">Menu</a>
  <div class="mobile-nav__sheet">
    <div class="mobile-nav__region">
    
    </div>
    <nav class="mobile-nav__main-menu">
    <h2 class="visually-hidden">Main menu</h2>
    <ul class="mobile-nav__navbar">
    <li><a href="/">Home</a></li>
    <li><a href="/post/" class="active" aria-current="page">Posts</a></li>
    </ul>
    </nav>
  </div>
</div>
</body>
</html>

<!DOCTYPE html>
<html class="nojs" lang="zh-cn" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>使用docker运行gogs服务 – psycode - better code, better life.</title>
<meta name="description" content=" 学习使用 gogs 搭建自己的 git 托管服务，但是不想在安装 gogs 时创建系统用户污染当前的 Mac 系统环境，决定使用 docker 启动该服务，同时学习一些基础的 docker 命令。  目标   使用 docker 和 docker-compose 运行并管理 gogs 服务   使用 caddy 为 gogs 搭建反向代 …">
<meta name="created" content="2019-02-13T11:22:54+0800">
<meta name="modified" content="2019-02-13T11:22:54+0800">

<meta name="contact" content="psyucc@163.com">
<meta property="og:site_name" content="psycode - better code, better life.">
<meta property="og:title" content="使用docker运行gogs服务">
<meta property="og:url" content="https://sh1yu.github.io/post/run-gogs-with-docker/">
<meta property="og:type" content="article">

<meta name="generator" content="Hugo 0.87.0" />
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<link rel="canonical" href="https://sh1yu.github.io/post/run-gogs-with-docker/">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<link rel="stylesheet" href="/css/mobile.2ab74aa64785dcab8114959e76ca140cf76207cd85989bc6d4fc3b12f734a09e.css" media="screen">
<link rel="stylesheet" href="/css/styles.220f12cbeefa3ca61dd63c4390295bf3974c4ba9557837d5e408db1b40a477ee.css">
<link rel="stylesheet" href="/css/print.27fc184f8670f41a2690985390779e7b20335a8fadff8fa015cf9417ffe50c36.css" media="print">

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "使用docker运行gogs服务",
    "datePublished": "2019-02-13T11:22:54+08:00",
    "dateModified": "2019-02-13T11:22:54+08:00",
    "url" : "https://sh1yu.github.io/post/run-gogs-with-docker/",
    "description": " 学习使用 gogs 搭建自己的 git 托管服务，但是不想在安装 gogs 时创建系统用户污染当前的 Mac 系统环境，决定使用 docker 启动该服务，同时学习一些基础的 docker 命令。  目标   使用 docker 和 docker-compose 运行并管理 gogs 服务   使用 caddy 为 gogs 搭建反向代 …",
    "keywords": ["docker","go","caddy","gogs"],
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://sh1yu.github.io"
    },
    "publisher": {
      "@type": "Organization",
      "name": "psycode - better code, better life.",
      "url": "https://sh1yu.github.io"
    }
  }
</script>

<script src="/js/script-early.min.3b0e641814c87f6a1d6ffa5e7d597f29faa8ce11482541e8801dc34013817c91.js"></script>
<script defer src="/js/lib/jquery.slim.min.bbb7b9921ca2b61948753a6edb63c78443663dc45d1621d18e102e1dcb34e512.js"></script>
<script defer src="/js/lib/umbrella.min.6e17830ccdded0a13b96d6993865b58202bc2ee750e5892a51858ab048b2bebb.js"></script>
<script defer src="/js/mobile.min.abb9438113cb72181ecda30b9375cc0771c7ce2e7354414a7c1296b45cf47135.js"></script>
<script src="/js/lib/js.cookie.min.31d1799663bbb6029214d90ba7db9cdc725fa02c16d4b090add3721e44238b6b.js"></script>
<script defer src="/js/cookieconsent.min.21a8d7c181aecb9bb5b91b2e1735d9fd9d283a8a752e9dcdf33c052137987f2b.js"></script>
<script defer src="/js/script.min.c2752732454d16255cfd30375b9a3e48a37b7b809c917b33920889c859ba1300.js"></script>


</head>

<body class="single-page">
<div class="page layout__page layout__sidebar-second">
<header class="header layout__header">

<h1 class="header__site-name">
<a href="/" title="Home" class="header__site-link" rel="home"><span>psycode - better code, better life.</span></a>
</h1>
<div class="region header__region">
</div>
</header>

<nav class="main-menu layout__navigation">
<h2 class="visually-hidden">Main menu</h2>
<ul class="navbar">
<li><a href="/">Home</a></li>
<li><a href="/post/" class="active" aria-current="page">Posts</a></li>
</ul>
</nav>


<main class="main layout__main">
<article class="section-post single-view">
<header>
<h1 class="title title-submitted">使用docker运行gogs服务</h1>
<div class="submitted">
<time class="created-date" datetime="2019-02-13T11:22:54&#43;08:00">13 February, 2019</time>
</div>
<div class="tags">
Tags:
<ul>
<li><a href="/tags/docker">docker</a></li>
<li><a href="/tags/go">go</a></li>
<li><a href="/tags/caddy">caddy</a></li>
<li><a href="/tags/gogs">gogs</a></li>
</ul>
</div>
</header>
<div class="content">
<blockquote>
<p>学习使用 gogs 搭建自己的 git 托管服务，但是不想在安装 gogs 时创建系统用户污染当前的 Mac 系统环境，决定使用 docker 启动该服务，同时学习一些基础的 docker 命令。</p>
</blockquote>
<h1 id="目标">目标</h1>
<ul>
<li>
<p>使用 docker 和 docker-compose 运行并管理 gogs 服务</p>
</li>
<li>
<p>使用 caddy 为 gogs 搭建反向代理</p>
</li>
<li>
<p>简单配置 caddy 与 gogs 容器的 docker 网络</p>
</li>
</ul>
<h1 id="工具与组件">工具与组件</h1>
<ul>
<li>docker for Mac：Mac环境下的 docker 服务版本，提供 docker 环境以及 docker-compose等命令</li>
<li>gogs : 一个 go 语言实现的简单快速的git代码托管服务，类似于 github 和 gitlab</li>
<li>caddy: go 语言实现的简单的web服务器，可进行反向代理，类似于 nginx</li>
</ul>
<h1 id="创建caddy配置">创建caddy配置</h1>
<p>创建<code>caddy</code>文件夹，并在文件夹下创建文件<code>Caddyfile</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#66d9ef">localhost</span> {
    <span style="color:#f92672">proxy</span> <span style="color:#e6db74">/</span> gogs:<span style="color:#ae81ff">3000</span> {
        <span style="color:#f92672">header_upstream</span> <span style="color:#e6db74">Host</span> {<span style="color:#f92672">host}</span>
        <span style="color:#e6db74">header_upstream</span> <span style="color:#e6db74">X-Real-IP</span> {<span style="color:#f92672">remote}</span>
        <span style="color:#e6db74">header_upstream</span> <span style="color:#e6db74">X-Forwarded-For</span> {<span style="color:#f92672">remote}</span>
        <span style="color:#e6db74">header_upstream</span> <span style="color:#e6db74">X-Forwarded-Proto</span> {<span style="color:#f92672">scheme}</span>
    <span style="color:#960050;background-color:#1e0010">}</span>
    <span style="color:#e6db74">log</span> <span style="color:#e6db74">/var/log/caddy.log</span>
    <span style="color:#e6db74">gzip</span>
    <span style="color:#75715e">#tls name@domain.com # 你的邮箱
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h1 id="使用-docker-compose-编排服务">使用 docker-compose 编排服务</h1>
<p>创建<code>docker-compose.yml</code>配置文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
<span style="color:#f92672">services</span>:
  <span style="color:#f92672">caddy</span>:
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">caddy</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">abiosoft/caddy</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#e6db74">&#34;/home/caddy/Caddyfile:/etc/Caddyfile&#34;</span> 
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;8081:2015&#34;</span>
<span style="color:#75715e">#    links:</span>
<span style="color:#75715e">#      - gogs</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
  <span style="color:#f92672">gogs</span>:
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">gogs</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">gogs/gogs</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">/home/gogs/data:/data</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;3022:22&#34;</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
</code></pre></div><h1 id="docker-compose-启动服务">docker-compose 启动服务</h1>
<p>在<code>docker-compose.yml</code>所在文件夹下运行命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose up -d
</code></pre></div><p>查看运行的容器，使用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose ps
</code></pre></div><p>或者</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker ps
</code></pre></div><p>其中 gogs 服务会使用<code>3000</code>端口，但是没有进行端口绑定，无法从外部访问。caddy 使用<code>2015</code>端口，并对外绑定<code>8081</code>端口，该访问通过<code>Caddyfile</code>配置文件转发到了 gogs 机器的<code>3000</code>端口。docker-compose 可以自动发现主机名称的地址，无需通过IP。通过如下地址访问 gogs 服务：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">http://127.0.0.1:8081
</span></code></pre></div><p>查看容器详细状态</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker inspect gogs
</code></pre></div><p>也可以进入正在运行的容器进行系统的状态、文件查看等操作</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker exec -it gogs /bin/bash
docker exec -it caddy /bin/sh
</code></pre></div><p>关闭服务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose stop
</code></pre></div><p>正常情况下关闭服务时容器不会被删除，重新启动时如果容器存在则不会再创建。<code>docker-compose.yml</code>有修改时旧的容器不会自动更新，需要关闭服务并删除容器，然后重新创建容器启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose down
docker-compose up -d
</code></pre></div><p>或者直接强制重新创建容器启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker-compose up -d --force-recreate
</code></pre></div><h1 id="网络配置固定ip">网络配置固定IP</h1>
<p>也可以自定义网络，然后给 gogs 和 caddy 容器分配固定的ip。</p>
<p>查看当前的docker网络</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker network ls
</code></pre></div><p><code>docker-compose.yml</code>配置网络</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
<span style="color:#f92672">services</span>:
  <span style="color:#f92672">caddy</span>:
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">caddy</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">abiosoft/caddy</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#e6db74">&#34;/home/caddy/Caddyfile:/etc/Caddyfile&#34;</span> 
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;8081:2015&#34;</span>
    <span style="color:#f92672">networks</span>:
        <span style="color:#f92672">default</span>:
            <span style="color:#f92672">ipv4_address</span>: <span style="color:#ae81ff">172.18.0.23</span>
<span style="color:#75715e">#    links:</span>
<span style="color:#75715e">#      - gogs</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>
  <span style="color:#f92672">gogs</span>:
    <span style="color:#f92672">container_name</span>: <span style="color:#ae81ff">gogs</span>
    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">gogs/gogs</span>
    <span style="color:#f92672">volumes</span>:
      - <span style="color:#ae81ff">/home/gogs/data:/data</span>
    <span style="color:#f92672">ports</span>:
      - <span style="color:#e6db74">&#34;3022:22&#34;</span>
    <span style="color:#f92672">networks</span>:
        <span style="color:#f92672">default</span>:
            <span style="color:#f92672">ipv4_address</span>: <span style="color:#ae81ff">172.18.0.25</span>
    <span style="color:#f92672">restart</span>: <span style="color:#ae81ff">always</span>

<span style="color:#f92672">networks</span>:
  <span style="color:#f92672">default</span>:
    <span style="color:#f92672">ipam</span>:
      <span style="color:#f92672">config</span>:
        - <span style="color:#f92672">subnet</span>: <span style="color:#ae81ff">172.18.0.0</span><span style="color:#ae81ff">/16</span>
<span style="color:#75715e">#          gateway: 172.18.0.1</span>
<span style="color:#75715e">#          ip_range: 172.18.0.0/24</span>
</code></pre></div><p>查看网络配置详情</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker network inspect gogs_default
</code></pre></div><p><code>docker-compose down</code>命令会同时移除网络。也可以手动移除网络:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker network rm gogs_default
</code></pre></div>

<aside class="related layout__related">
</aside>
</div>
</article>
</main>


<aside class="sidebar layout__second-sidebar">
<section>
<h4 class="menu"><a href="/post/" class="active" aria-current="page">Posts</a></h4>
<ul class="menu">
<li><a href="/post/golang%E7%BB%84%E5%90%88%E6%8E%A5%E5%8F%A3%E4%BB%A5%E5%8F%8A%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">golang组合、接口以及反序列化</a></li>
<li><a href="/post/%E4%B8%80%E6%AC%A1springboot&#43;dubbo%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">一次springboot&#43;dubbo的项目实战</a></li>
<li><a href="/post/vscode%E9%85%8D%E7%BD%AEcpp%E5%A4%96%E9%83%A8%E5%A4%B4%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96/">Vscode配置cpp外部头文件依赖</a></li>
<li><a href="/post/install-mysql-in-k8s/">在k8s集群中部署mysql</a></li>
<li><a href="/post/sign-model/">SIGN模型找到天赋</a></li>
<li><a href="/post/knowledge-to-ability/">将知识内化成能力</a></li>
<li><a href="/post/iceberg-model/">冰山模型</a></li>
<li><a href="/post/kubernetes-statefulset/">kubernetes之StatefulSet</a></li>
<li><a href="/post/vert.x-and-future/">Vert.x线程与Future</a></li>
<li><a href="/post/archlinux-operation/">archlinux使用操作拾遗</a></li>
<li><a href="/post/run-gogs-with-docker/" class="active" aria-current="page">使用docker运行gogs服务</a></li>
</ul>
</section>
</aside>
<footer class="footer layout__footer">
<p>This site is licensed under a (<a href="https://creativecommons.org/licenses/by-sa/4.0/)">https://creativecommons.org/licenses/by-sa/4.0/)</a>. [Creative Commons Attribution-ShareAlike 4.0 International License]</p>
<p>A <a href="https://example.org/">example.org</a> production.</p>
<p>Powered by <a href="https://gohugo.io/">Hugo</a> and the <a href="https://github.com/frjo/hugo-theme-zen">Zen theme</a>.</p>
</footer>
<div class="cookieconsent layout__cookieconsent hidden">
  <div class="cookieconsent__message">
    This website uses non essential cookies for tracking and analytics that you can accept or decline.
    
  </div>
  <div class="cookieconsent__actions">
    <button class="button button--small button--cookieconsent button--decline" type="button" data-consent="false">Decline tracking</button>
    <button class="button button--small button--cookieconsent button--accept" type="button" data-consent="true">Accept tracking</button>
  </div>
</div>
</div>
<div class="mobile-nav" dir="ltr">
  <div class="mobile-nav__cover"></div>
  <a href="#navigation" class="mobile-nav__toggle" aria-haspopup="true" role="button">Menu</a>
  <div class="mobile-nav__sheet">
    <div class="mobile-nav__region">
    
    </div>
    <nav class="mobile-nav__main-menu">
    <h2 class="visually-hidden">Main menu</h2>
    <ul class="mobile-nav__navbar">
    <li><a href="/">Home</a></li>
    <li><a href="/post/" class="active" aria-current="page">Posts</a></li>
    </ul>
    </nav>
  </div>
</div>
</body>
</html>
